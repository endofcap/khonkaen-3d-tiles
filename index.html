<!DOCTYPE html>
<html lang="en">
<head>
    <title>Gaia3D magoReality - MapLibre 3D Tiles</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://unpkg.com/deck.gl@latest/dist.min.js"></script>
    <script src="https://unpkg.com/@loaders.gl/3d-tiles@latest/dist/dist.min.js"></script>

    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        .info-panel {
            position: absolute; top: 10px; left: 10px; z-index: 1;
            background: rgba(0, 0, 0, 0.7); color: white; padding: 15px;
            border-radius: 5px; font-family: sans-serif; font-size: 14px;
        }
    </style>
</head>
<body>

<div id="map"></div>
<div class="info-panel">
    <strong>magoReality Service</strong><br>
    Data: Khon Kaen, Thailand (Reality Mesh)<br>
    Engine: MapLibre GL JS + Deck.gl
</div>

<script>
    const { MapboxLayer } = deck;
    const { Tile3DLayer } = deck;
    const { Tiles3DLoader } = loaders;

    // 2. MapLibre 지도 초기화 (콘캔시 좌표 설정)
    const map = new maplibregl.Map({
        container: 'map',
        style: 'https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json', // 다크 모드 배경
        center: [102.8298, 16.4626], // 경도, 위도
        zoom: 15.5,
        pitch: 66,
        bearing: 0,
        antialias: true
    });

    map.on('load', () => {
        // 3. Deck.gl의 Tile3DLayer를 MapLibre 커스텀 레이어로 추가
        const tile3dLayer = new MapboxLayer({
            id: 'tile-3d-layer',
            type: Tile3DLayer,
            data: 'https://seoul.gaia3d.com:10107/mago_tiler/output/Thailand_All/tileset.json',
            loader: Tiles3DLoader,
            
            // 데이터 최적화 설정
            pointSize: 1,
            onTileLoad: (tileHeader) => {
                console.log('Tile loaded:', tileHeader);
            }
        });

        map.addLayer(tile3dLayer);
        
        // 지도 컨트롤 추가
        map.addControl(new maplibregl.NavigationControl());
    });
</script>

</body>
</html>